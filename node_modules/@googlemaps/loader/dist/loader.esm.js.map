{"version":3,"file":"loader.esm.js","sources":["../src/loader.ts"],"sourcesContent":["/**\n * Copyright 2019 Google LLC. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/// <reference types=\"@types/googlemaps\" />\n/* eslint-disable @typescript-eslint/no-explicit-any */\n\nexport interface LoaderOptions {\n  apiKey: string;\n  version?: string;\n  libraries?: string[];\n  channel?: string;\n  language?: string;\n  clientId?: string;\n  region?: string;\n}\n\nexport class Loader {\n  public version: string;\n  public apiKey: string;\n  public libraries: string[];\n  public channel: string;\n  public language: string;\n  public clientId: string;\n  public region: string;\n\n  private CALLBACK = \"__google_maps_callback\";\n  private URL = \"https://maps.googleapis.com/maps/api/js\";\n  private callbacks: Array<(e: Event) => any> = [];\n  private done = false;\n  private loading = false;\n  private onerrorEvent: Event;\n\n  constructor({\n    apiKey,\n    libraries = [],\n    channel,\n    language,\n    clientId,\n    region,\n    version\n  }: LoaderOptions) {\n    this.version = version;\n    this.apiKey = apiKey;\n    this.libraries = libraries;\n    this.channel = channel;\n    this.language = language;\n    this.clientId = clientId;\n    this.region = region;\n  }\n\n  public createUrl(): string {\n    let url = this.URL;\n\n    url += \"?callback=\" + this.CALLBACK;\n\n    if (this.apiKey) {\n      url += \"&key=\" + this.apiKey;\n    }\n\n    if (this.libraries.length > 0) {\n      url += \"&libraries=\" + this.libraries.join(\",\");\n    }\n\n    if (this.clientId) {\n      url += \"&client=\" + this.clientId;\n    }\n\n    if (this.channel) {\n      url += \"&channel=\" + this.channel;\n    }\n\n    if (this.language) {\n      url += \"&language=\" + this.language;\n    }\n\n    if (this.region) {\n      url += \"&region=\" + this.region;\n    }\n\n    if (this.version) {\n      url += \"&v=\" + this.version;\n    }\n\n    return url;\n  }\n\n  public load(): Promise<void> {\n    return this.loadPromise();\n  }\n\n  public loadPromise(): Promise<any> {\n    return new Promise((resolve, reject) => {\n      this.loadCallback((err: Event) => {\n        if (!err) {\n          resolve();\n        } else {\n          reject(err);\n        }\n      });\n    });\n  }\n\n  public loadCallback(fn: (e: Event) => any): void {\n    this.callbacks.push(fn);\n    this.execute();\n  }\n\n  private setScript(): void {\n    const url = this.createUrl();\n    const script = document.createElement(\"script\");\n\n    script.type = \"text/javascript\";\n    script.src = url;\n    script.onerror = this.loadErrorCallback;\n    script.defer = true;\n    script.async = true;\n    document.head.appendChild(script);\n  }\n\n  private loadErrorCallback(e: Event): void {\n    this.onerrorEvent = e;\n    this.callback();\n  }\n\n  private setCallback(): void {\n    (window as any)[this.CALLBACK] = this.callback.bind(this);\n  }\n\n  private callback(): void {\n    this.done = true;\n    this.loading = false;\n\n    this.callbacks.forEach(cb => {\n      cb(this.onerrorEvent);\n    });\n\n    this.callbacks = [];\n  }\n\n  private execute(): void {\n    if (this.done) {\n      this.callback();\n    } else {\n      if (this.loading) {\n        // do nothing but wait\n      } else {\n        this.loading = true;\n        this.setCallback();\n        this.setScript();\n      }\n    }\n  }\n}\n"],"names":[],"mappings":"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"}